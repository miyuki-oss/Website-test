<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Safe Sex Info</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #5b2c6f;
      display: flex;
      align-items: stretch;
      height: 100vh;
      color: #fff;
    }
    .side-panel {
      width: 300px;
      background: #8e44ad;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      transition: width 0.3s;
      overflow: hidden;
      align-items: flex-start;
      position: relative;
    }
    .side-panel.collapsed {
      width: 50px;
      align-items: center;
    }
    .toggle-btn {
      background: #6c3483;
      border: none;
      color: #fff;
      padding: 8px;
      cursor: pointer;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .card {
      background: #9b59b6;
      padding: 30px 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      width: 100%;
      position: relative;
    }
    .card h3 {
      margin: 0;
      color: #e0b3ff;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card a {
      display: block;
      margin-top: 8px;
      color: #e0b3ff;
      text-decoration: underline;
      font-size: 14px;
    }
    .side-panel.collapsed .card::before {
      content: '';
      display: block;
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: #e0b3ff;
    }
    .side-panel.collapsed .card:nth-child(2)::before { content: '\f05a'; } /* info-circle */
    .side-panel.collapsed .card:nth-child(3)::before { content: '\f058'; } /* check-circle */
    .side-panel.collapsed .card h3, .side-panel.collapsed .card a {
      display: none;
    }
    .chatbot-shortcut {
      background: #7d3c98;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: absolute;
      bottom: 20px;
      right: 20px;
      color: #e0b3ff;
      font-size: 18px;
    }
    /* Main content and forum styles */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow: auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05));
      color: #fff;
    }
    .forum {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.03);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }
    .forum h2 {
      margin: 0 0 12px 0;
      color: #ffd9ff;
    }
    .forum form { display:flex; flex-direction:column; gap:10px; margin-bottom:12px; }
    .form-row { display:flex; gap:8px; }
    input[type="text"], textarea {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.08);
      background: transparent;
      color:#fff;
      resize: vertical;
    }
    .btn { background:#8e44ad; color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
    .posts { display:flex; flex-direction:column; gap:12px; margin-top:12px; }
    .post { background: rgba(0,0,0,0.2); padding:12px; border-radius:8px; }
    .post .meta { font-size:12px; color:#e0b3ff; display:flex; justify-content:space-between; align-items:center; }
    .post .content { margin-top:8px; white-space:pre-wrap; }
    .post .actions { display:flex; gap:8px; margin-top:8px; }
    .small-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); padding:6px 8px; border-radius:6px; color:#fff; cursor:pointer; }
    .clear-btn { background:#c0392b; border:none; padding:8px 10px; border-radius:8px; color:#fff; cursor:pointer; }
    /* Chat panel */
    .chat-panel {
      position: fixed;
      right: 24px;
      bottom: 80px;
      width: 320px;
      max-height: 70vh;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.2));
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 9999;
      transform: translateY(12px);
    }
    .chat-panel.hidden { display: none; }
    .chat-header { padding: 10px 12px; background: #7d3c98; display:flex; align-items:center; justify-content:space-between; color:#fff; }
    .chat-header .title { display:flex; gap:8px; align-items:center; font-weight:600; }
    .chat-body { padding: 12px; overflow:auto; flex:1; display:flex; flex-direction:column; gap:8px; }
    .messages { display:flex; flex-direction:column; gap:8px; }
    .message { max-width: 85%; padding:8px 10px; border-radius:10px; line-height:1.2; }
    .message.bot { background: rgba(255,255,255,0.06); align-self:flex-start; color:#fff; }
    .message.user { background: rgba(255,255,255,0.12); align-self:flex-end; color:#fff; }
    .quick-replies { display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
    .quick-replies button { background:transparent; border:1px solid rgba(255,255,255,0.08); color:#fff; padding:6px 8px; border-radius:8px; cursor:pointer; }
    .chat-input { display:flex; gap:8px; padding:10px; border-top:1px solid rgba(255,255,255,0.04); background: rgba(0,0,0,0.04); }
    .chat-input input { flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; }
    .chat-input .send-btn { background:#8e44ad; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="side-panel" id="sidePanel">
    <button class="toggle-btn" id="toggleBtn"><i class="fas fa-bars"></i></button>
    <div class="card">
      <h3><i class="fas fa-info-circle"></i> About Safe Sex</h3>
      <a href="#"><i class="fas fa-arrow-right"></i> What to know about safe sex</a>
      <a href="#"><i class="fas fa-map-marker-alt"></i> Nearest facilities</a>
      <a href="#"><i class="fas fa-hospital-alt"></i> Know your local clinics</a>
      <a href="#"><i class="fas fa-virus"></i> What to know about STD</a>
      <a href="#"><i class="fas fa-gavel"></i> Government policies and rights</a>
    </div>
    <div class="card">
      <h3><i class="fas fa-check-circle"></i> Self Assessment</h3>
      <a href="#" title="General health checklist"><i class="fas fa-list"></i> General health checklist</a>
      <a href="#" title="STD symptom checklist"><i class="fas fa-virus"></i> STD symptom checklist</a>
      <a href="#" title="Contraception checklist"><i class="fas fa-pills"></i> Contraception checklist</a>
      <a href="#" title="Mental health checklist"><i class="fas fa-heart"></i> Mental health checklist</a>
      <a href="#" title="When to see a clinician"><i class="fas fa-user-md"></i> When to see a clinician</a>
    </div>

    <div class="chatbot-shortcut" id="chatbotShortcut"><i class="fas fa-comment"></i></div>
  </div>
  </div>

  <main class="main-content" id="mainContent">
    <section class="forum" id="forum">
      <h2><i class="fas fa-comments"></i> Community Forum</h2>
      <form id="postForm">
        <div class="form-row">
          <input type="text" id="authorInput" placeholder="Your name (optional)" maxlength="60" />
        </div>
        <div>
          <textarea id="messageInput" placeholder="Share something helpful, ask a question, or tell your story..." rows="4" maxlength="2000"></textarea>
        </div>
        <div class="form-row">
          <button type="submit" class="btn">Post</button>
          <button type="button" id="clearAllBtn" class="clear-btn">Clear All Posts</button>
        </div>
      </form>

      <div class="posts" id="postsContainer">
        <!-- Posts will render here -->
      </div>
    </section>
  </main>

  <script>
    const toggleBtn = document.getElementById('toggleBtn');
    const sidePanel = document.getElementById('sidePanel');

    toggleBtn.addEventListener('click', () => {
      sidePanel.classList.toggle('collapsed');
    });

    const chatbotShortcut = document.getElementById('chatbotShortcut');

    // Chat panel elements will be inserted into the DOM; create and manage chat here
    function buildChatPanel() {
      const panel = document.createElement('section');
      panel.className = 'chat-panel hidden';
      panel.id = 'chatPanel';
      panel.innerHTML = `
        <div class="chat-header">
          <div class="title"><i class="fas fa-robot"></i> Health Bot</div>
          <div>
            <button id="minimizeChat" title="Close" class="small-btn"><i class="fas fa-times"></i></button>
          </div>
        </div>
        <div class="chat-body">
          <div class="messages" id="chatMessages"></div>
          <div class="quick-replies" id="quickReplies"></div>
        </div>
        <div class="chat-input">
          <input id="chatInput" placeholder="Type a message..." autocomplete="off" />
          <button id="sendBtn" class="send-btn">Send</button>
        </div>
      `;
      document.body.appendChild(panel);
      return panel;
    }

    const chatPanel = buildChatPanel();
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const minimizeChat = document.getElementById('minimizeChat');
    const quickReplies = document.getElementById('quickReplies');

    function openChat() {
      chatPanel.classList.remove('hidden');
      renderWelcome();
      chatInput.focus();
    }

    function closeChat() {
      chatPanel.classList.add('hidden');
    }

    minimizeChat.addEventListener('click', closeChat);

    // Fixed responses mapping
    const canned = {
      hello: 'Hello! I\'m a simple help bot. You can ask me about safe sex basics, clinics, or checklists.',
      help: 'Try these: "safe sex", "clinic", "self assessment", or "emergency".',
      'safe sex': 'Use condoms consistently, get regular testing, and talk openly with partners.',
      clinic: 'Find local clinics under About Safe Sex → Nearest facilities. If you need immediate care, go to your nearest ER.',
      'self assessment': 'Open the Self Assessment links in the side panel to use the checklists. If you want, I can show a quick checklist here.',
      emergency: 'If this is an emergency, call your local emergency number immediately or go to the nearest hospital.'
    };

    const defaultReply = <img src = "https://github.com/miyuki-oss/Website-test/blob/main/Images/test1.png">;

    function addMessage(text, who = 'bot') {
      const el = document.createElement('div');
      el.className = 'message ' + (who === 'user' ? 'user' : 'bot');
      el.innerText = text;
      chatMessages.appendChild(el);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function respondTo(text) {
      const t = text.toLowerCase();
      // simple keyword matching
      for (const key of Object.keys(canned)) {
        if (t.includes(key)) return canned[key];
      }
      return defaultReply;
    }

    function handleSend() {
      const txt = chatInput.value && chatInput.value.trim();
      if (!txt) return;
      addMessage(txt, 'user');
      chatInput.value = '';
      const reply = respondTo(txt);
      setTimeout(() => addMessage(reply, 'bot'), 350);
    }

    sendBtn.addEventListener('click', handleSend);
    chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleSend(); } });

    // Quick replies
    const quickList = [
      {label: 'Hello', value: 'hello'},
      {label: 'Safe sex tips', value: 'safe sex'},
      {label: 'Find clinic', value: 'clinic'},
      {label: 'Self assessment', value: 'self assessment'},
      {label: 'Emergency', value: 'emergency'}
    ];

    function renderQuickReplies() {
      quickReplies.innerHTML = '';
      quickList.forEach(q => {
        const b = document.createElement('button');
        b.type = 'button';
        b.innerText = q.label;
        b.addEventListener('click', () => {
          addMessage(q.label, 'user');
          setTimeout(() => addMessage(respondTo(q.value), 'bot'), 250);
        });
        quickReplies.appendChild(b);
      });
    }

    function renderWelcome() {
      chatMessages.innerHTML = '';
      addMessage('Hi — I\'m here to help with quick, fixed answers about safe sex and clinics. Try a quick reply or type a question.');
      renderQuickReplies();
    }

    // wire shortcut to open chat
    chatbotShortcut.addEventListener('click', () => {
      // toggle
      if (chatPanel.classList.contains('hidden')) openChat(); else closeChat();
    });

    // Forum (client-side only, localStorage-backed)
    const postsKey = 'forum_posts_v1';
    const postForm = document.getElementById('postForm');
    const authorInput = document.getElementById('authorInput');
    const messageInput = document.getElementById('messageInput');
    const postsContainer = document.getElementById('postsContainer');
    const clearAllBtn = document.getElementById('clearAllBtn');

    let posts = [];

    function loadPosts() {
      try {
        posts = JSON.parse(localStorage.getItem(postsKey) || '[]');
      } catch (e) {
        posts = [];
      }
    }

    function savePosts() {
      localStorage.setItem(postsKey, JSON.stringify(posts));
    }

    function timeAgo(iso) {
      const delta = Math.floor((Date.now() - new Date(iso)) / 1000);
      if (delta < 60) return `${delta}s`;
      if (delta < 3600) return `${Math.floor(delta/60)}m`;
      if (delta < 86400) return `${Math.floor(delta/3600)}h`;
      return `${Math.floor(delta/86400)}d`;
    }

    function renderPosts() {
      postsContainer.innerHTML = '';
      if (!posts || posts.length === 0) {
        postsContainer.innerHTML = '<p>No posts yet — be the first to share!</p>';
        return;
      }

      // Show newest first
      const list = posts.slice().reverse();
      list.forEach(post => {
        const el = document.createElement('article');
        el.className = 'post';

        el.innerHTML = `
          <div class="meta">
            <div><strong>${escapeHtml(post.author || 'Anonymous')}</strong> · <span title="${post.time}">${timeAgo(post.time)}</span></div>
            <div class="actions">
              <button class="small-btn" data-action="like" data-id="${post.id}"><i class="fas fa-thumbs-up"></i> ${post.likes || 0}</button>
              <button class="small-btn" data-action="delete" data-id="${post.id}"><i class="fas fa-trash"></i></button>
            </div>
          </div>
          <div class="content">${escapeHtml(post.content)}</div>
        `;

        postsContainer.appendChild(el);
      });
    }

    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function addPost(author, content) {
      const post = {
        id: Date.now().toString(36) + Math.random().toString(36).slice(2,7),
        author: author ? author.trim() : 'Anonymous',
        content: content.trim(),
        likes: 0,
        time: new Date().toISOString()
      };
      posts.push(post);
      savePosts();
      renderPosts();
    }

    postsContainer.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const action = btn.getAttribute('data-action');
      const id = btn.getAttribute('data-id');
      if (action === 'like') {
        const p = posts.find(x => x.id === id);
        if (p) { p.likes = (p.likes || 0) + 1; savePosts(); renderPosts(); }
      } else if (action === 'delete') {
        if (!confirm('Delete this post?')) return;
        posts = posts.filter(x => x.id !== id);
        savePosts();
        renderPosts();
      }
    });

    postForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const author = authorInput.value;
      const message = messageInput.value;
      if (!message || !message.trim()) {
        alert('Please enter a message before posting.');
        return;
      }
      addPost(author, message);
      postForm.reset();
    });

    clearAllBtn.addEventListener('click', () => {
      if (!posts || posts.length === 0) return;
      if (!confirm('Clear all posts from this browser? This cannot be undone.')) return;
      posts = [];
      savePosts();
      renderPosts();
    });

    // Initialize forum
    loadPosts();
    renderPosts();
  </script>
</body>
</html>








